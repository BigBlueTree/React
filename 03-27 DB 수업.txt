--Q2 부서별
--부서코드 부서명 급여평균 최대급여 최소급여 부서인원수
SELECT D.DEPTNO AS 부서코드, D.DNAME AS 부서명, 
    ROUND(AVG(E.SAL),2) AS 평균급여, 
    MAX(E.SAL) AS 최대급여, 
    MIN(E.SAL) AS 최소급여, 
    COUNT(E.EMPNO) AS 부서인원수
FROM EMP E
INNER JOIN DEPT D
ON E.DEPTNO=D.DEPTNO
GROUP BY D.DEPTNO, D.DNAME; 

--Q3 부서별 고용인의 정보
--부서코드 부서명 사원번호 이름 직급 봉급
SELECT D.DEPTNO AS 부서코드, D.DNAME AS 부서명, E.EMPNO AS 사원번호,
E.ENAME AS 이름, E.JOB AS 직급, E.SAL AS 봉급
FROM DEPT D
INNER JOIN EMP E ON D.DEPTNO = E.DEPTNO
ORDER BY D.DEPTNO;

--Q4 부서별
--부서코드 부서명 사번 사원명 관리자사번 관리자명
-- 급여 해당사원의급여등급 등급최저급여 등급최고급여
SELECT D.DEPTNO AS 부서코드, D.DNAME AS 부서명, E1.EMPNO AS 사번, E1.ENAME AS 사원명, E1.MGR AS 관리자사번, E2.ENAME AS 관리자명,
       E1.SAL AS 급여,G.GRADE AS 급여등급, G.LOSAL AS 최저급여, G.HISAL AS 최고급여
FROM DEPT D
INNER JOIN EMP E1 ON D.DEPTNO = E1.DEPTNO
LEFT OUTER JOIN EMP E2 ON E1.MGR = E2.EMPNO
INNER JOIN SALGRADE G ON E1.SAL BETWEEN G.LOSAL AND G.HISAL
ORDER BY D.DEPTNO, E1.EMPNO;

--------------------------------------------------------------(ORACLE 방식)
SELECT D.DEPTNO,D.DNAME,E.EMPNO,E.ENAME
    ,E.MGR,E2.ENAME AS MGR_ENAME
    ,E.SAL,S.GRADE,S.LOSAL,S.HISAL
FROM EMP E,DEPT D, SALGRADE S,EMP E2
WHERE E.DEPTNO=D.DEPTNO
AND E.SAL BETWEEN S.LOSAL(+) AND S.HISAL
AND E.MGR=E2.EMPNO(+)
ORDER BY D.DEPTNO,E.EMPNO;

---------------------------------------------------------(서브 쿼리)
SELECT R1.DEPTNO,R1.DNAME,R1.EMPNO,R1.ENAME
    ,R1.MGR,R1.MGR_NAME
    ,R1.SAL,S.GRADE,S.LOSAL,S.HISAL
FROM
(
SELECT R0.DEPTNO,R0.DNAME,R0.EMPNO,R0.ENAME
    ,R0.MGR,E1.ENAME AS MGR_NAME
    ,R0.SAL
FROM
(
SELECT D0.DEPTNO,D0.DNAME,E0.EMPNO,E0.ENAME,E0.MGR,E0.SAL
FROM DEPT D0
LEFT OUTER JOIN EMP E0 ON D0.DEPTNO=E0.DEPTNO
ORDER BY D0.DEPTNO,E0.ENAME
) R0
LEFT OUTER JOIN EMP E1 ON R0.MGR=E1.EMPNO
)R1
LEFT OUTER JOIN SALGRADE S ON (R1.SAL BETWEEN S.LOSAL AND S.HISAL)
ORDER BY R1.DEPTNO,R1.EMPNO;

/*VIEW
    WITH
    별칭 AS SELECT ...
    
    SELECT
    FROM 별칭
*/
SELECT E10.EMPNO,E10.ENAME,E10.DEPTNO,D.DNAME,D.LOC
FROM (SELECT * FROM EMP WHERE DEPTNO=10) E10
    ,(SELECT * FROM DEPT) D
WHERE E10.DEPTNO=D.DEPTNO;

WITH
E10 AS (SELECT * FROM EMP WHERE DEPTNO=10),
D AS (SELECT * FROM DEPT)

SELECT E10.EMPNO,E10.ENAME,E10.DEPTNO,D.DNAME,D.LOC
FROM E10,D
WHERE E10.DEPTNO=D.DEPTNO;

--Q1 ALLEN 사원의 직급과 동일한 사원들의
--직급 사번 상원명 봉급 부서코드 부서명
SELECT E2.JOB AS 직급, E2.EMPNO AS 사번, E2.ENAME AS 사원명, E2.SAL AS 봉급, D.DEPTNO AS 부서코드, D.DNAME AS 부서명
FROM EMP E1
INNER JOIN EMP E2 ON E1.JOB = E2.JOB AND E1.EMPNO <> E2.EMPNO
INNER JOIN DEPT D ON E2.DEPTNO = D.DEPTNO
WHERE E1.EMPNO = '7499';

--Q2 전체 평균 급여보다 많이 받는 사원의
--사번 사원명 부서 입사일(YYYY-MM-DD) 부서명 부서위치 급여 급여등급
SELECT E.EMPNO,E.ENAME
    ,TO_CHAR(E.HIREDATE,'YYYY-MM-DD') HIREDATE
    ,D.DNAME,D.LOC,E.SAL,S.GRADE
FROM EMP E, DEPT D, SALGRADE S
WHERE E.DEPTNO=D.DEPTNO AND E.SAL BETWEEN S.LOSAL AND S.HISAL
AND E.SAL>(SELECT AVG(SAL) FROM EMP)
ORDER BY E.SAL DESC,E.ENAME;

--Q3 10번 부서의 인원 중 30번 부서에 없는 직급을 가진 직원의
--사번 사원명 직급 부서코드 부서명 부서위치
SELECT E.EMPNO AS 사번, E.ENAME AS 사원명, E.JOB AS 직급, E.DEPTNO AS 부서코드, D.DNAME AS 부서명, D.LOC AS 부서위치
FROM EMP E,DEPT D
WHERE E.DEPTNO=D.DEPTNO
AND E.DEPTNO=10
AND NOT E.JOB IN(SELECT E.JOB FROM EMP E WHERE E.DEPTNO=30);

SELECT E.EMPNO AS 사번, E.ENAME AS 사원명, E.JOB AS 직급, E.DEPTNO AS 부서코드, D.DNAME AS 부서명, D.LOC AS 부서위치
FROM EMP E,DEPT D
WHERE E.DEPTNO=D.DEPTNO
AND E.DEPTNO=10
AND E.JOB <> ALL(SELECT DISTINCT E1.JOB FROM EMP E1 WHERE E1.DEPTNO=30);

--Q4 SALESMAN의 최대급여보다 많은 급여를 받는 사람들의
--사번 사원명 급여 급여등급
SELECT E.EMPNO AS 사번, E.ENAME AS 사원명, E.SAL AS 급여, S.GRADE AS 급여등급
FROM EMP E,SALGRADE S
WHERE E.SAL BETWEEN S.LOSAL AND S.HISAL
AND E.SAL>ALL(SELECT SAL FROM EMP WHERE JOB = 'SALESMAN');

SELECT E.EMPNO AS 사번, E.ENAME AS 사원명, E.SAL AS 급여, S.GRADE AS 급여등급
FROM EMP E,SALGRADE S
WHERE E.SAL BETWEEN S.LOSAL AND S.HISAL
AND E.SAL>(SELECT MAX(SAL) FROM EMP WHERE JOB = 'SALESMAN');


